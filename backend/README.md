# Бэкенд веб-приложения SOS-Котопес

Этот репозиторий содержит бэкенд для веб-приложения SOS-Котопес.
Бэкенд построен с использованием Go и предоставляет RESTful API для взаимодействия с системой

## Список задач

Следующие задачи ожидают выполнения для завершения разработки бэкенда:

- [ ] **Логгер**
- Заменить стандартный логгер Fiber на пользовательскую реализацию.

- [ ] **CI (Непрерывная интеграция)**
- Настроить CI pipeline для автоматизации тестирования, сборки и развертывания.

- [X] **Docker Compose**
- Файл `docker-compose.yml` для оркестрации приложения и его зависимостей с использованием Docker.

- [X] **Лицензия**
- Файл LICENSE для указания условий лицензирования проекта.

- [X] **README**
- Написать подробный файл README.

- [ ] **Автоматические миграции базы данных**
- Реализовать автоматические миграции базы данных.

- [ ] **Документация Swagger**
- Выбрать библиотеку для автоматической генерации Swagger API, добавить аннотации для обработчиков.


## Начало работы

### Предварительные требования

- Go 1.22.5+
- PostgreSQL
- Docker (опционально, для развертывания в контейнерах)

### Установка

1. Клонируйте репозиторий:

    ```sh
    git clone https://github.com/kotopesp/sos-kotopes.git
    cd sos-kotopes/backend
    ```

2. Установите зависимости:

    ```sh
    go mod tidy
    ```

### Запуск приложения

Для запуска приложения выполните команду:

```sh
make run
```

*примечание*: Для выполнения команды `PG_URL` в Makefile должен быть обновлен.

### Запуск через Docker Compose

Заполните `docker-compose.yml` файл (пока не поддерживается) и выполните команду:

```sh
docker-compose up --build
```

### Миграции базы данных

Для того, чтобы вручную запустить миграцию базы данных выполните команду:

```sh
make migrate-up
```

*примечание*: Для выполнения команды `PG_URL` в Makefile должен быть обновлен.

## Практики разработки

### Добавление зависимостей

При добавлении новых зависимостей в проект:

1. Добавьте вашу зависимость в файл `go.mod` используя команду `go get` или напрямую редактируя `go.mod`.
2. Выполните команду `go mod vendor` .

### Проверка качества кода

Для поддержки качества кода, придерживайтесь данных практик:

- Выполняйте команду `make lint` перед коммитами или отправкой Pull Request'ов чтобы убедиться в том, что ваш код соответствует стандартам линтера.

## Настройка авторизации через телеграм
**Шаги:**
1. Cоздать бота в телеграм.
2. Установить в его настройках домен 127.0.0.1 для локального тестирования. Когда появится домен, то указать его.
3. Перейти на страницу https://core.telegram.org/widgets/login.
4. Там нужно зарегестрироваться через телеграм и указать своего бота
5.  Далее поставить `redirect_url` https://localhost:8080/api/v1/auth/login/telegram/callback. Скопировать `embed_code`. Это кнопка, которая должна появиться где-то на фронтенде.

## Настройка авторизации через ВК
**Шаги:**
1. Создать приложение здесь: https://id.vk.com/about/business/go.
2. Нужно заполнить поле _базовый домен_: `localhost` (для локального тестирования). В поле _доверенный redirect url_ нужно вставить `https + домен + api/v1/auth/login/vk/callback`.
3. На бэкенде в `Makefile` нужно заполнить `vk_client_id` - это нужно взять из `ID приложения`, `vk_client_secret` нужно взять из `Защищенный ключ`.
4. Также в `Makefile` нужно указать `vk_callback` которы должен быть равен полю _доверенный redirect url_.

## Благодарности

- [Fiber](https://github.com/gofiber/fiber/v2)
- [GORM](https://gorm.io/)
- [zerolog](https://github.com/rs/zerolog)
- [PostgreSQL](https://www.postgresql.org/)